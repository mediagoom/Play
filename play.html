<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <meta http-equiv="X-UA-Compatible" content="IE=11">

    <title>MediaGoom Player</title>
   
    <link href="style/bootstrap.min.css" rel="stylesheet" />

    <style>
        body
        {
            font-family: "Open Sans Light", sans-serif;
            font-weight: normal;
        }

        h1
        {
            letter-spacing: -0.05em;
            text-shadow: 0px 1px 0px rgba(255,255,255,0.75);
        }

        .fulllength
        {
            width: 100%;
        }
        
        .center{
            text-align: center;
        }

        .player
        {
            background-color: black;
        }

        #logo
        {
            margin-top:-10px;
            height:200%;
            width:auto;
        }

        .responsive_player
        {
            width: 100%;
            height: auto;
        }

        .row
        {
            max-width:90%;
            margin-left: auto;
            margin-right: auto;
        }
    </style>

    <script src="scripts/jquery-1.9.0.min.js"></script>
    <script src="scripts/bootstrap.min.js"></script>

    <script src="src/bundle.js"></script>
 
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
</head>
<body>

    <script>
        
        
        function get_default_options()
        {

            var options = {
                "player":
                    {
                          dash: true
                        , flash: false
                        , hls: true
                        , html5: true
                    }
                , "protocols":
                    {
                        dash: true
                        , ssf: true
                        , hls: true
                        , progressive: true
                    }
                , "encrypted" : false
            }

            return options;

        }
        

        var options = get_default_options();

        function options2UI()
        {
            $('#playerhtml5').attr('checked', options.player.html5);
            $('#playerhls').attr('checked', options.player.hls);
            $('#playerdash').attr('checked', options.player.dash);
            $('#playerflash').attr('checked', options.player.flash);

            $('#progressive').attr('checked', options.protocols.progressive);
            $('#hls').attr('checked', options.protocols.hls);
            $('#dash').attr('checked', options.protocols.dash);
            $('#ssf').attr('checked', options.protocols.ssf);

            $('#clearkey').attr('checked', options['org.w3.clearkey']);
            $('#playready').attr('checked', options['com.microsoft.playready']);

        }

        function UI2options() {

            options.player.html5 = $('#playerhtml5').prop('checked');
            options.player.hls = $('#playerhls').prop('checked');
            options.player.dash = $('#playerdash').prop('checked');
            options.player.flash = $('#playerflash').prop('checked');

            options.protocols.progressive = $('#progressive').prop('checked');
            options.protocols.hls = $('#hls').prop('checked');
            options.protocols.dash = $('#dash').prop('checked');
            options.protocols.ssf = $('#ssf').prop('checked');

        }

        function external_play(externalurl, segment)
        {
            var src = document.getElementById('playerurl').value;

            var url = URI(src);
                url = url.segment(segment);
            var url_to = url.absoluteTo(location.href);
            
            location.href = externalurl + url_to;
        }

        function HLS() {
            var src = document.getElementById('playerurl').value;
        }

        
        function DASH() {
            var src = document.getElementById('playerurl').value;

            var url = URI(src);
            url = url.segment('index.mpd');
            var url_to = url.absoluteTo(location.href);


            location.href = 'http://dashif.org/reference/players/javascript/1.4.0/samples/dash-if-reference-player/index.html?url=' + url_to;
        }

        function DASH2() {
            var src = document.getElementById('playerurl').value;

            var url = URI(src);
            url = url.segment('index.mpd');
            var url_to = url.absoluteTo(location.href);


            location.href = 'https://cdn.rawgit.com/Dash-Industry-Forum/dash.js/v2.3.0/samples/dash-if-reference-player/index.html?url=' + url_to;
        }

        function HLSFLASH()
        {
            //external_play('http://www.flashls.org/latest/examples/chromeless/?src=', 'main.m3u8');

            external_play('http://www.flashls.org/latest/examples/osmf/StrobeMediaPlayback.html?src=', 'main.m3u8');
        }


        
        
        function getParamValuesByName(querystring, def) {
            var qstring = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < qstring.length; i++) {
                var urlparam = qstring[i].split('=');
                if (urlparam[0] == querystring) {
                    return urlparam[1];
                }
            }

            return def;
        }

        function playhere(autoplay, options, autouri)
        {

            if (autouri == null)
                autouri = true;

            var src = document.getElementById('playerurl').value;
            var div = document.getElementById('playerhost');
        
            var width = div.clientWidth * 0.8;

            var height = width / 16 * 9;

            width  = Math.floor(width);
            height = Math.floor(height);

            var id = 'playerX';

            var DEFMSG = "No Combination of protocols player could be successfully found";
            var poster = src + '/poster.jpg';
            var html = DEFMSG;
        
            var controls = true;
            
            /*

            if (options.player.dash && options.protocols.dash
                && ( (!options.encrypted) || options['org.w3.clearkey'] || options['com.microsoft.playready'] )
                )
            {
                var v5 = html5embed(height, width, null, poster, id, controls, autoplay);

                div.innerHTML = v5;

                var uri = src;

                if (autouri) {
                    if (options.encrypted)
                    {
                        if(options['com.microsoft.playready'])
                        {
                            uri += '/pr.mpd';
                        }
                        else if(options['org.w3.clearkey'])
                        {
                            uri += '/ck.mpd';
                        }
                        else
                            throw 'invalid configuration found.'

                    }
                    else
                        uri += '/index.mpd'
                }
            
                dodash(uri, 'playerX');

                return;
            }

            if (options.player.hls
                && options.protocols.hls
                ) {

                var uri = src;

                if (autouri)
                    uri += '/main.m3u8';

                var hls = html5embed(height, width, uri, poster, id, controls, autoplay);

                div.innerHTML = hls;

                return;

                
            }

            if (options.player.flash)
            {
                var url = src;

                if (autouri) {


                    var full = URI(src);
                        src  = full.absoluteTo(location.href);
                
                    
                        url = src + '/main.m3u8';
                }
            
                var flash = flashembedhtml(height, width, 'ClientBin/StrobeMediaPlayback.swf', url, poster, autoplay, controls, id);

                html = flash;
            }

            

            if (DEFMSG == html && options.player.html5 && options.protocols.progressive)
            {
                var uri = src;

                if (autouri)
                    uri += '/index.mp4';

                var hls = html5embed(height, width, uri, poster, id, controls, autoplay);

                html = hls;
            }

            div.innerHTML = html;

            */
        }

        /*
        function playhere_async(autoplay, options, autouri) {
            if('calling' ===  options['org.w3.clearkey'] 
                || 'calling' === options['com.microsoft.playready'])
            {
                window.setTimeout(function () { playhere_async(autoplay, options, autouri); }, 100);
                return;
            }
            
            options2UI(); 
            playhere(autoplay, options, autouri);

        }
        */

        

    </script>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="http://www.mediagoom.com">
                    <img id="logo" src="img/MediaGoom.png" alt="MediaGoom" />
                </a>

                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
			<!--<li><a href="http://www.mediagoom.com/blog">Blog</a></li>
			-->
                    
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Static Player Samples <span class="caret"></span></a>
			<ul class="dropdown-menu">
				<!--
                            <li><a href="javascript:HLS()">Hls</a></li>
			    <li><a href="javascript:DASH()">Dash 1.4.0</a></li>
                -->
                <!--
                <li><a href="javascript:DASH2()">Dash 2.3.0</a></li>
                -->
			    <!--
			    <li><a href="FLASH.html">Flash </a></li>
			    
                            
                            <li role="separator" class="divider"></li>

                            <li><a href="javascript:HLSFLASH()">Hls With Flash</a></li>
                            -->

                        </ul>
                    </li>

		    

                </ul>
               
            </div>
        </div>
    </nav>

    <div class="container-fluid">

        <div class="row">
            <div class="col-md-12 center">
                <h1>Media Goom Sample Player</h1>
            </div>
        </div>

        <div class="row">

            <div class="col-md-12 center">
                <div id="playerhost" class="player">

                </div>

            </div>

        </div>

        <div class="row">

            <div class="col-md-12 center">
            </div>
        </div>

        <!--
        <div class="row">

            <div class="col-md-12 center">


                <div class="input-group">
                    <span class="input-group-addon" id="sizing-addon2">Content:</span>
                    <input type="text" class="form-control" placeholder="" aria-describedby="sizing-addon2" id="playerurl" value="bb">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick="playhere(true, options);">Play</button>
                    </span>

                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" onclick='$("#media_test").modal("show");'>Configure</button>
                    </span>
          
                </div>

            </div>
        </div>
        -->


        <div class="modal fade" id="media_test" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">Player Configuration</h4>
                    </div>
                    <div class="modal-body">


                        <div class="panel panel-default">
                            <div class="panel-heading">Players</div>
                            <div class="panel-body">
                                <div class="checkbox">
                                    <label><input type="checkbox" value="html5" id="playerhtml5" checked>Html 5</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="flash" id="playerflash" checked>Flash&nbsp;&nbsp;</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="dash" id="playerdash" checked>Dash&nbsp;&nbsp;</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="hls" id="playerhls" checked>HLS&nbsp;&nbsp;&nbsp;&nbsp;</label>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">Protocols</div>
                            <div class="panel-body">
                                <div class="checkbox">
                                    <label><input type="checkbox" value="progressive" id="progressive" checked>progressive download</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="dash" id="dash" checked>Mpeg Dash&nbsp;&nbsp;</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="ssf" id="ssf" checked>smooth streaming&nbsp;&nbsp;</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="flush" id="hls" checked>Http Live Stream</label>
                                </div>
                            </div>
                        </div>

                        <div class="panel panel-default">
                            <div class="panel-heading">DRM</div>
                            <div class="panel-body">
                                <div class="checkbox">
                                    <label><input type="checkbox" value="clearkey" id="clearkey">clearkey</label>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" value="playready" id="playready" >Play Ready&nbsp;&nbsp;</label>
                                </div>
                                
                            </div>
                        </div>

                        

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" id="tryit" class="btn btn-primary" onclick="UI2options();" data-dismiss="modal">Save</button>
                    </div>
                </div>
            </div>
        </div>


     </div>

            <script>


                $(function () {
                   
                    //options
                                       
                    var src = getParamValuesByName('src', 'play.json');
                    if(null != src)
                    {
                        src = src.replace(/%3D/g, '=');
                        src = src.replace(/%20/g, ' ');
                    }
                        
                    //var autouri   = getParamValuesByName('autouri');
                    //var encrypted = getParamValuesByName('encrypted');

                    var vplayer    = getParamValuesByName('player');
                    
                    var autoplay   = getParamValuesByName('autoplay', true);
                    var muted      = getParamValuesByName('muted', false);
                    var controls   = getParamValuesByName('controls', true);
                    
                    var jsoninfo   = getParamValuesByName('jsoninfo');

                    var info = {}
                  
                    var opt = { autoplay : new Boolean( autoplay )
                        , controls : new Boolean( controls )
                        , muted : new Boolean( muted )
                    };

                    var player = window.mgPlayer(opt);

                    if(null != jsoninfo)
                    {
                        $.getJSON( src, function( data ) {
                            
                            $.each( data.links, function( index, value ) {
                                    if(value.id === jsoninfo)
                                    {
                                        info = value;
                                    }
                            });    
                            
                            if(info.id)
                            {
                                player.play(src, info);
                            }
                            else
                            {
                                console.error("invalid info", JSON.stringify(info));
                            }

                        });
                
                    }
                    else
                    {
                        //We have a specific player and a url
                        if (null != vplayer && src != null) {
                            info[vplayer] = src;
                            player.play(location.href, info);
                        }
                        else
                        {
                            //We just have a url. It should point to and info otherwise we do not no how to handle it.
                            $.getJSON( src, function( data ) {
                                player.play(src, info);
                            });
                        }
                    }
                
                });

            </script>



</body>
</html>
